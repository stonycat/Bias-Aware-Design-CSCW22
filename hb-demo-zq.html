<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Booking Hotel</title>

  <!-- Bootstrap4 core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/hotel.css" rel="stylesheet">
  <link href="css/slider.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <!-- Bootstrap4 core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/jquery-slim.min.js"><\/script>')</script>
  <script src="js/popper.min.js"></script>
  <script src="js/holder.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap-slider.js"></script>
  <script src="https://kit.fontawesome.com/4421af3ebc.js" crossorigin="anonymous"></script>
  <script type="text/javascript" src="json/t1.js"></script> 
</head>

<body>
  <!-- Empty element, will be filled in the content by the code below -->
  <div id="handlebars-rendering-target"></div>

  <script id="entry-template" type="text/x-handlebars-template">
    {{!-- Template, mixing html with handlebars syntax --}}
    <div class="body">
      <div class="container">
      <!-- <h1>{{title}}</h1> --> <!--Header-->
      <header class="blog-header py-3">
        <div class="row flex-nowrap justify-content-between align-items-center">
          <div class="col-4 pt-1">
            <a class="text-muted" href="#">Hotel Web</a>
          </div>
          <div class="col-4 text-center">
          </div>
          <div class="col-4 d-flex justify-content-end align-items-center">
            <a class="btn btn-sm btn-outline-secondary" href="#">Consent Form</a>
          </div>
        </div>
      </header>

      <div class="jumbotron p-3 p-md-5 text-white rounded bg-dark">
        <div class="col-md-12 px-0">
          <h1 class="display-5 font-italic">Task Design</h1>
          <p class="lead">Imagine that you are going on vacation to New York, a city you have never been to. 
            Now you need to book a hotel online in advance. 
            Here we provide some 4-stars hotels for you to choose from.</p>
          <!-- <p class="lead mb-0"><a href="#" class="text-white font-weight-bold">Continue reading...</a></p> -->
        </div>
      </div>
      <!--Header end-->   

        <!--hotel card start-->
        {{#each hotels as |hotel| }}
        <div class="row mb-2">
          <div class="col-md-12">
            <div class="card flex-md-row mb-4 box-shadow h-md-280">
              <img class="card-img-left flex-auto d-none d-md-block" data-src={{hotel.img}} alt="Card image cap">
              <div class="card-body d-flex flex-column align-items-start">
              <h4>
                <a class="text-dark font-serif" id="hotel-{{hotel.index}}" href="#">#{{addone hotel.index}} {{hotel.name}}</a>
              </h4>
                <!-- <h4 class="mb-0">
                <a class="text-dark" id="hotel-{{hotel.index}}" href="#">{{hotel.name}}</a>
              </h4> -->
              <div class="mb-1 text-muted">{{hotel.price}}</div>
              <div class="rating">
                {{#ifEquals hotel.rating '5.0'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '4.5'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '4.0'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="far fa-star"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '3.5'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
                <i class="far fa-star"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '3.0'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                {{/ifEquals}}
              </div>
              <p><i class="fas fa-user"></i> {{hotel.ratingNum}} </p>
              {{> reviewmodal hotel=hotel}}

              </div><!--card-body1 end-->
            </div><!--card1 end flex-md-row mb-4 box-shadow h-md-280-->
          </div><!--hotel1 end col-md-12-->
        </div><!--row mb-2 end-->
        {{/each}}<!--hotel card end-->


      </div><!--container end-->
    </div><!--body end-->
    
  </script>

  <script id="modal-template" type="text/x-handlebars-template">
    {{!-- Modal template, using partial --}}
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-outline-primary btn-sm" data-toggle="modal" data-target="#modal-{{hotel.index}}">
      View user feedback
    </button>

    <!-- Modal -->
    <div class="modal fade bd-example-modal-lg" id="modal-{{hotel.index}}" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">About Hotel #{{addone hotel.index}}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
            <!--vis-->
            <!-- <div id="vis-{{hotel.index}}"></div> -->
            <div id="modal-vis-{{hotel.index}}"></div>

            <div class="tab-pane fade active show" id="pills-reviews" role="tabpanel" aria-labelledby="pills-reviews-tab">
              <div class="bg-white rounded shadow-sm p-4 mb-4 restaurant-detailed-ratings-and-reviews">
                <h5 class="mb-1">All Reviews</h5>
                  <div class="reviews-members pt-4 pb-4">
                    {{#each hotel.reviews as |review|}}
                      <h6 class="mb-1"><a class="text-black" href="#">{{review.username}}</a></h6>
                      <p class="mb-1 text-muted">{{review.user_wrote_time}}</p>
                      <div class="rating">
                        {{#ifEquals review.currentRating '5'}}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        {{/ifEquals}}
                        {{#ifEquals review.currentRating '4'}}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        {{/ifEquals}}
                        {{#ifEquals review.currentRating '3'}}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        {{/ifEquals}}
                        {{#ifEquals review.currentRating '2'}}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        {{/ifEquals}}
                        {{#ifEquals review.currentRating '1'}}
                        <i class="fas fa-star"></i>
                        {{/ifEquals}}
                      </div>
                      <p>{{review.content}}</p>
                    {{/each}}
                  </div>
                  <!-- <a class="text-center w-100 d-block mt-4 font-weight-bold" href="#">See All Reviews</a> -->

              </div>
            </div>
          </div><!--modal-body end-->
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
          </div>
        </div>
      </div>
    </div><!--model fade end-->
  </script>

  <script>
    // load data from js file
    console.log("load json by var in js")
    console.log(context);
    

    context.hotels.forEach((hotel, i) => {
      hotel.index = i;
      //console.log(hotel.index);
    })
  </script>
  <script>
    // Funcations to modify content
    Handlebars.registerHelper('addone', value => value + 1);
    Handlebars.registerHelper('ifEquals', function(arg1, arg2, options){ //show user rating
      return (arg1 == arg2) ? options.fn(this):options.inverse(this);
    });

    // Partials, like a component
    Handlebars.registerPartial('reviewmodal', document.getElementById("modal-template").innerHTML);

    // Code to render data into template
    var source = document.getElementById("entry-template").innerHTML;
    var template = Handlebars.compile(source);
    var rendered = template(context);
    //console.log(rendered); // Debug
    document.getElementById('handlebars-rendering-target').innerHTML = rendered;
  </script>

  <script type="text/javascript">
    // code to run after the elements are created
    context.hotels.forEach(hotel => {
      var vegaSpec = {
        $schema: 'https://vega.github.io/schema/vega-lite/v4.json',
        description: 'A simple bar chart with embedded data.',
        data: { values: hotel.totalRatingData },
        mark: 'bar',
        encoding: {
          x: {
            field: 'a',
            type: 'ordinal'
          },
          y: {
            field: 'b',
            type: 'quantitative'
          }
        }
      }
      // vegaEmbed('#vis-' + hotel.index, vegaSpec)
      $('#modal-' + hotel.index).on('shown.bs.modal', function (e) {
        vegaEmbed('#modal-vis-' + hotel.index, vegaSpec)
      })
    })
  </script>
</body>

</html>