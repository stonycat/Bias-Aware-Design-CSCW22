<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Booking Hotel</title>

  <!-- Bootstrap4 core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/hotel.css" rel="stylesheet">
  <link href="css/slider.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <!-- <script src="/node_modules/readmore-js/readmore.min.js"></script> -->
  <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://raw.githubusercontent.com/jedfoster/Readmore.js/master/readmore.js"></script> -->
  <!-- Bootstrap4 core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/jquery-slim.min.js"><\/script>')</script>
  <!-- <script src="js/readmore.js"></script> -->
  <!-- <script src="/node_modules/readmore-js/readmore.min.js"></script> -->
  
  <script src="js/popper.min.js"></script>
  <script src="js/holder.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap-slider.js"></script>
  <script src="https://kit.fontawesome.com/4421af3ebc.js" crossorigin="anonymous"></script>
  <script src="json/Alhambra_Hotel_95_4.0.js"></script>
  <script src="json/Best_Western_Swiss_Cottage_Hotel_120_3.5.js"></script>
  <script src="json/Camden_Enterprise_Hotel_106_4.5.js"></script>
  <script src="json/Chelsea_Cloisters_79_3.0.js"></script>
  <script src="json/Glenlyn_Hotel_91_4.5.js"></script>
  <script src="json/Hampton_by_Hilton_London_Waterloo_99_4.5.js"></script>
  <script src="json/Henley_House_Hotel_107_4.0.js"></script>
  <script src="json/Holiday_Inn_Express_London_Hammersmith_99_4.0.js"></script>
  <script src="json/Holiday_Inn_Express_London_Victoria_104_3.5.js"></script>
  <script src="json/Holiday_Inn_London_West_110_4.5.js"></script>
  <script src="json/Ibis_London_Blackfriars_Hotel_90_4.0.js"></script>
  <script src="json/Ibis_London_Earls_Court_108_3.5.js"></script>
  <script src="json/Ibis_Styles_London_Southwark_99_4.0.js"></script>
  <script src="json/La_Suite_West_Hyde_Park_102_4.0.js"></script>
  <script src="json/Lancaster_Gate_Hotel_118_3.5.js"></script>
  <script src="json/London_House_Hotel_108_4.0.js"></script>
  <script src="json/Martel_Guest_House_90_4.5.js"></script>
  <script src="json/Mayflower_Hotel_90_3.0.js"></script>
  <script src="json/OYO_Huttons_Hotel_82_3.0.js"></script>
  <script src="json/Point_A_Hotel_London_Shoreditch_102_4.5.js"></script>
  <script src="json/Prince_Regent_Hotel_Excel_London_103_4.0.js"></script>
  <script src="json/Residence_Inn_Marriott_London_Bridge_103_4.5.js"></script>
  <script src="json/St_Giles_London_120_3.5.js"></script>
  <script src="json/The_29_London_FKA_Airways_Hotel_Victoria_79_3.0.js"></script>
  <script src="json/The_Captain_Cook_103_4.5.js"></script>
  <script src="json/The_Royal_Foundation_of_St_Katharine_107_4.5.js"></script>
  <script src="json/The_W14_Kensington_79_4.0.js"></script>
  <script src="json/The_Westbourne_Hyde_Park_116_4.5.js"></script>
  <script src="json/Thistle_City_Barbican_Shoreditch_103_3.0.js"></script>
  <script src="json/Travelodge_London_Central_City_Road_99_4.0.js"></script>
  <script src="json/Travelodge_London_Docklands_84_4.0.js"></script>
  <script src="json/Travelodge_London_Excel_84_4.0.js"></script>
  <script src="json/Travelodge_London_Greenwich_High_Road_99_4.0.js"></script>
  <script src="json/Travelodge_London_Vauxhall_Hotel_95_4.0.js"></script>
  <script src="json/Victor_Hotel_London_Victoria_101_3.5.js"></script>
  <script type="text/javascript" src="json/t1.js"></script>
  
  



  <!-- <style>
    *{margin:0px;padding:0px;}
    .one_review{width:500px;height:100%;border:1px solid red;margin:10px auto 0px;}
    </style> -->
</head>

<body>
  <!-- Empty element, will be filled in the content by the code below -->
  <div id="handlebars-rendering-target"></div>

  <script id="entry-template" type="text/x-handlebars-template">
    {{!-- Template, mixing html with handlebars syntax --}}
    <div class="body">
      <div class="container">
      <!-- <h1>{{title}}</h1> --> <!--Header-->
      <header class="blog-header py-3">
        <div class="row flex-nowrap justify-content-between align-items-center">
          <div class="col-4 pt-1">
            <a class="text-muted" href="#">Hotel Web</a>
          </div>
          <div class="col-4 text-center">
          </div>
          <div class="col-4 d-flex justify-content-end align-items-center">
            <a class="btn btn-sm btn-outline-secondary" href="#">Consent Form</a>
          </div>
        </div>
      </header>

      <div class="jumbotron p-3 p-md-5 text-white rounded bg-dark">
        <div class="col-md-12 px-0">
          <h1 class="display-5 font-italic">Task Design</h1>
          <p class="lead">Imagine that you are going on vacation to New York, a city you have never been to. 
            Now you need to book a hotel online in advance. 
            Here we provide some 4-stars hotels for you to choose from.</p>
          <!-- <p class="lead mb-0"><a href="#" class="text-white font-weight-bold">Continue reading...</a></p> -->
        </div>
      </div>
      <!--Header end-->   

        <!--hotel card start-->
        {{#each hotels as |hotel| }}
        <div class="row mb-2">
          <div class="col-md-12">
            <div class="card flex-md-row mb-4 box-shadow h-md-280">
              <img class="card-img-left flex-auto d-none d-md-block" data-src={{hotel.img}} alt="Card image cap">
              <div class="card-body d-flex flex-column align-items-start">
              <h4>
                <a class="text-dark font-serif" id="hotel-{{hotel.index}}" href="#">#{{addone hotel.index}} {{hotel.name}}</a>
              </h4>
                <!-- <h4 class="mb-0">
                <a class="text-dark" id="hotel-{{hotel.index}}" href="#">{{hotel.name}}</a>
              </h4> -->
              <div class="mb-1 text-muted">{{hotel.price}}</div>
              <div class="rating">
                {{#ifEquals hotel.rating '5.0'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '4.5'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '4.0'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="far fa-star"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '3.5'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
                <i class="far fa-star"></i>
                {{/ifEquals}}
                {{#ifEquals hotel.rating '3.0'}}
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                {{/ifEquals}}
              </div>
              <p><i class="fas fa-user"></i> {{hotel.ratingNum}} </p>
              {{> reviewmodal hotel=hotel}}

              </div><!--card-body1 end-->
            </div><!--card1 end flex-md-row mb-4 box-shadow h-md-280-->
          </div><!--hotel1 end col-md-12-->
        </div><!--row mb-2 end-->
        {{/each}}<!--hotel card end-->
      <!-- <div class="readall_box">
        <div class="read_more_mask"></div>
        <a class="read_more_btn" href="javascript:void(0);" target="_self">Readall</a>
      </div> -->


      </div><!--container end-->
    </div><!--body end-->
    
  </script>

  <script id="modal-template" type="text/x-handlebars-template">
    {{!-- Modal template, using partial --}}
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-outline-primary btn-sm" data-toggle="modal" data-target="#modal-{{hotel.index}}">
      View user feedback
    </button>

    <!-- Modal -->
    <div class="modal fade bd-example-modal-lg" id="modal-{{hotel.index}}" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">About Hotel #{{addone hotel.index}}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
            <!--vis-->
            <!-- <div id="vis-{{hotel.index}}"></div> -->
            <div id="modal-vis-{{hotel.index}}"></div>

            <div class="tab-pane fade active show" id="pills-reviews" role="tabpanel" aria-labelledby="pills-reviews-tab">
              <div class="bg-white rounded shadow-sm p-4 mb-4 restaurant-detailed-ratings-and-reviews">
                <h5 class="mb-1">All Reviews</h5>
                  <div class="reviews-members pt-4 pb-4">
                    <!-- <div class = "one_review"> -->
                      <!-- <a class="text-dark font-serif" id="hotel-{{hotel.index}}" href="#">#{{addone hotel.index}} {{hotel.name}}</a> -->
                      {{#each hotel.reviews as |review|}}
                      <div class="one_review" id="hotel-{{hotel.index}}-review-{{review.index}}">
                        <!-- <img data-src=user-img.png alt="UserImg"> -->
                        <a href="#"><img alt="Avatar" src="user-img.png" 
                          class="mr-3" style="border-radius: 50rem; width: 56px;
                          height: 56px;"></a >
                        <h6 class="mb-1"><a class="text-black" href="#">{{review.user_name}}</a></h6>
                        <small>Contributions: {{review.contriNum}} &nbsp; &nbsp; &nbsp; Helpful number: {{review.helpfulNum}}</small> 
                        <!-- <small>Helpful number: {{review.helpfulNum}} &nbsp; &nbsp; &nbsp; Contribution number: {{review.contriNum}}</small>  -->
                        <!-- <small>Contribution number: {{review.contriNum}}</small>     -->
                        <!-- <h6 class="mb-1"><a class="text-black" href="#">{{review.username}}</a></h6>  -->
                        <!-- h means title(head) -->
                        <!-- <p class="mb-1">{{review.username}}</p> -->
                        <p class="mb-1 text-muted">{{review.user_wrote_time}}</p>
                        <div class="rating">
                          {{#ifEquals review.currentRating '5.0'}}
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          {{/ifEquals}}
                          {{#ifEquals review.currentRating '4.0'}}
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          {{/ifEquals}}
                          {{#ifEquals review.currentRating '3.0'}}
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          {{/ifEquals}}
                          {{#ifEquals review.currentRating '2.0'}}
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          {{/ifEquals}}
                          {{#ifEquals review.currentRating '1.0'}}
                          <i class="fas fa-star"></i>
                          {{/ifEquals}}
                        </div>
                        <!-- <p>{{review.username}}</p> -->
                        <!-- <div class="keywords"> -->
                        <!-- {{#each review.keywords as |keyword|}}
                          <h7 class="mb-1">Keywords</h7> -->
                          <!-- <p class="mb-1 text-muted">{{keyword}}</p>
                        {{/each}} --> 
                        <!-- </div> -->
                        <!-- <div class = "contents">
                          <p data-controller="#readMore">{{review.content}}</p>
                          <a id="readMore" class="timeline-read-more"></a>
                        </div> -->
                        <p>Keywords # {{#each review.keywords as |word|}} <span class="badge">{{word}}</span>{{/each}}<p class = 'contents'>{{review.content}}</p></p>
                        
                        <!-- <p>{{review.content}}</p> -->
                        <!-- {{#each review.keywords}}
                          <p>{{review.keywords}}</p>
                        {{/each}} -->
                        <!-- <p>Keywords # {{review.keywords}}</p> -->
                      </div>
                      
                      {{/each}}
                      <a href="#" class = "loading-hotel-{{hotel.index}}">Load More</a>
                      <!-- <a href="#" id="load">Load More</a> -->
                    <!-- </div> -->
                    
                  </div>
                  <!-- <a class="text-center w-100 d-block mt-4 font-weight-bold" href="#">See All Reviews</a> -->

              </div>
            </div>
          </div><!--modal-body end-->
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
          </div>
        </div>
      </div>
    </div><!--model fade end-->
  </script>


  <script type="text/javascript">
    // read more contents function
      $(function(){
        // $('.review').each(function(){
          $('.contents').each(function(){
              var maxwidth=300;//设置最多显示的字数
              var text_long=$(this).text();
              var text_short = text_long.substring(0,maxwidth);
              if($(this).text().length>maxwidth){
                  // $(this).text($(this).text().substring(0,maxwidth));
                  $(this).html(text_short+"..."+"<a href='#' id= 'readmore'> Read all</a>");
                  // $(this).html($(this).html()+"..."+"<a href='###'> Read all</a>");//如果字数超过最大字数，超出部分用...代替，并且在后面加上点击展开的链接；
  
              };
              $(this).find("a[id^= 'readmore' ]").click(function(){
                  // $(this).parent().html(text+"<a href='###'> Read less</a>");//点击“点击展开”，展开全文
                  $(this).parent().html(text_long+"<a href='##' id = 'readless'>Read less</a>").parent().css({"height":"475px"})
                  
                  // $(this).addClass('less');
                // $(this).html($(this).html()+"..."+"<a href='###'> Read all</a>");
                // $(this).html($(this).html()+"<a href='###'> Read less</a>");
              //点击“点击展开”，展开全文
                  // $(this).parent().css({"height":"600px","width":"100px"})
                  // $(this).html($(this).html()+"<a href='###'> Read less</a>");
              //     $(this).find('a').click(function(){
              //     $(this).parent().html(text_short+"..."+"<a href='###'> Read all</a>");
              //   // $(this).html($(this).html()+"..."+"<a href='###'> Read all</a>");
              //   // $(this).html($(this).html()+"<a href='###'> Read less</a>");
              // })
              })
              $(this).find("a[id = 'readless' ]").click(function(){
                  $(this).parent().html(text_short).parent().css({"height":"350px"})
              })
          })
        // })
      })
  </script>

  <script>
  $(function(){
    // context.hotels.forEach(hotel => {
    $('.reviews-members').each(function(index,element){
      var read_more = $(this).find("a");
      // $('.reviews-members').find("div[id^='hotel-{{hotel.index}}']").slice(0, 10).show(); // select the first ten
      var all_reviews = $(this).find("div[class ='one_review']");
      all_reviews.each(function(index,element){
        $(this).css({"display":'none'});
      }); 

      all_reviews.slice(0,10).show();
      read_more.click(function(){
        // e.preventDefault();
        $(all_reviews[style='display:none']).slice(0,20).show();
      })
      // all_reviews


      // $(".one_review").css({'display':'none'})



      // $("a[id^='loading']").click(function(e){ // click event for load more
      //     e.preventDefault();
      //     $('.one_review:hidden').slice(0, 10).show(); // select next 10 hidden divs and show them
      //     if($('.one_review:hidden').length == 0){ // check if any hidden divs still exist
      //         alert("No more divs"); // alert if there are none left
      //     }
      // });
    })
  // })
  })
  </script>


  <script>
    // load data from js file
    console.log("load json by var in js")
    console.log(context);
    

    context.hotels.forEach((hotel, i) => {
      hotel.index = i;
      //console.log(hotel.index);
    })
  </script>
  <script>
    // Funcations to modify content
    Handlebars.registerHelper('addone', value => value + 1);
    Handlebars.registerHelper('ifEquals', function(arg1, arg2, options){ //show user rating
      return (arg1 == arg2) ? options.fn(this):options.inverse(this);
    });

    // Partials, like a component
    Handlebars.registerPartial('reviewmodal', document.getElementById("modal-template").innerHTML);

    // Code to render data into template
    var source = document.getElementById("entry-template").innerHTML;
    var template = Handlebars.compile(source);
    var rendered = template(context);
    //console.log(rendered); // Debug
    document.getElementById('handlebars-rendering-target').innerHTML = rendered;
  </script>

  <script type="text/javascript">
    // code to run after the elements are created
    context.hotels.forEach(hotel => {
      var vegaSpec = {
        $schema: 'https://vega.github.io/schema/vega-lite/v4.json',
        description: 'A simple bar chart with embedded data.',
        data: { values: hotel.totalRatingData },
        mark: 'bar',
        encoding: {
          x: {
            field: 'a',
            type: 'ordinal'
          },
          y: {
            field: 'b',
            type: 'quantitative'
          }
        }
      }
      // vegaEmbed('#vis-' + hotel.index, vegaSpec)
      $('#modal-' + hotel.index).on('shown.bs.modal', function (e) {
        vegaEmbed('#modal-vis-' + hotel.index, vegaSpec)
      })
    })
  </script>
  <script src="jquery-read-more.min.js"></script>




  <!-- <script>
    $(function(){    
        //一开始显示数据
        //实际中应该是将分页的效果做成加载更多的效果 但是调取数据的原理 是一样的 就是显示数据的效果不一样
        ajax();
        $(document).scroll(function(){
            //滚动条滑动的时候获取滚动条距离顶部的距离
            var scroll=$(document).scrollTop();
            //屏幕的高度
            var client=$(window).height();
            var h=$(document).height();
            var flag=true;
            if (h<=scroll+client) { // 到达底部时,加载新内容
                if(flag==false){
                    return;
                }
                ajax();
            }
            
        });
        function ajax(){
            $.ajax({
                url:'https://sug.so.360.cn/suggest?callback=suggest_so&encodein=utf-8&encodeout=utf-8&format=json&fields=word,obdata&word=新闻',
                type:'GET',
                dataType:'jsonp',
                success:function(data){
                    flag=false;
                    setTimeout(function(){//只是模拟一下需要有个时间过程表示正在调取数据
                        for(var i=0;i<data.result.length;i++){
                            var result=data.result[i];
                            var odiv='<span style="font-size:35px;margin:10px;line-height:50px;">'+result.word+'</span></br>'+
                                    '<span style="font-size:35px;margin:10px;line-height:50px;">'+result.word+'</span></br>';
                            $(".one_review").append(odiv);
                        }
                    },500);
                    
                },
            });
        };
        
    });
    </script> -->
  <!-- <script>
//     $(".readmore").readmore({
//       speed: 75, // how fast to animate
//       maxHeight: 100 // how much to show, in pixels, before the link to read more
// });
    $('article').readmore();
  </script> -->
</body>

</html>